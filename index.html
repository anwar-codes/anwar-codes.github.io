<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Rhythm Hero Lite v6.0.9</title>
  <link rel="stylesheet" href="style.css?v=610">
</head>
<body>
  <header id="topbar">
    <button id="menuBtn" type="button" aria-controls="panel" aria-expanded="false" onclick="RH_togglePanel()">☰</button>
    <h1>Rhythm Hero Lite <small id="statusDot" class="st-bad">●</small><small id="fileName"></small></h1>
  </header>

  <section id="panel" class="collapsed" aria-expanded="false">
    <div class="inner">
      <div class="controls">
        <label class="file">
          <input type="file" id="fileInput" accept=".mp3,.wav,.ogg,audio/mpeg,audio/*">
          <span>Unggah Lagu (MP3/WAV/OGG)</span>
        </label>
        <button id="analyzeBtn" disabled>Analisa & Buat Not</button>
        <button id="playBtn" disabled>Mainkan</button>
        <button id="pauseBtn" disabled>Jeda</button>
        <button id="restartBtn" disabled>Ulang</button>

        <label class="speed">
          Kecepatan:
          <input type="range" id="speedInput" min="0.7" max="1.8" step="0.05" value="1.0">
          <span id="speedVal">1.0x</span>
        </label>

        <label class="startfrom">
          Mulai dari:
          <select id="startSel">
            <option value="firstlead">Not Pertama (−2s)</option>
            <option value="zero">0s (awal lagu)</option>
            <option value="custom">Kustom…</option>
          </select>
          <input id="customStart" type="number" value="0" step="0.1" min="0">s
        </label>
        <button id="jumpFirstBtn" disabled>Loncat ke Not Pertama</button>

        <label class="latency">
          Offset ms:
          <input type="number" id="latencyInput" value="0" step="5">
        </label>
        <button id="calibrateBtn">Kalibrasi</button>

        <label class="diff">Kesulitan:
          <select id="diffSel">
            <option value="easy">Easy</option>
            <option value="normal" selected>Normal</option>
            <option value="hard">Hard</option>
          </select>
        </label>
      </div>

      <div class="sfx">
        <label class="file small">
          <input type="file" id="hitSfxInput" accept=".mp3,.wav,.ogg,audio/mpeg,audio/*">
          <span>Upload SFX Hit</span>
        </label>
        <label class="file small">
          <input type="file" id="missSfxInput" accept=".mp3,.wav,.ogg,audio/mpeg,audio/*">
          <span>Upload SFX Miss</span>
        </label>
        <label class="vol">Vol Hit
          <input type="range" id="hitVol" min="0" max="1" step="0.05" value="0.7">
        </label>
        <label class="vol">Vol Miss
          <input type="range" id="missVol" min="0" max="1" step="0.05" value="0.6">
        </label>
      </div>

      <div class="chartio">
        <button id="exportBtn">Export Chart</button>
        <label class="file small">
          <input type="file" id="importInput" accept="application/json">
          <span>Import Chart</span>
        </label>
      </div>
    </div>
  </section>

  <canvas id="game"></canvas>

  <div id="touchLanes">
    <button data-lane="0">A</button>
    <button data-lane="1">S</button>
    <button data-lane="2">D</button>
    <button data-lane="3">F</button>
  </div>

  <div id="hud" hidden>
</div>

  <div id="progress" aria-live="polite" hidden>
    <div class="box">
      <div class="title">Menganalisis lagu…</div>
      <div id="progressLog">Menunggu…</div>
    </div>
  </div>

  <script src="main.js?v=610" defer></script>

  <!-- Toggle panel & enable analyze (iOS-safe) -->
  <script>
    (function(){ ['#togglePanel','#fabToggle','details > summary'].forEach(sel=>{
      document.querySelectorAll(sel).forEach(el=>el.remove());
    }); })();

    (function(){
      var panel = document.getElementById('panel');
      var open = (localStorage.getItem('panelOpen') === '1');
      panel.classList.toggle('collapsed', !open);
      panel.setAttribute('aria-expanded', open ? 'true' : 'false');
      var btn = document.getElementById('menuBtn');
      if(btn) btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      window.addEventListener('load', ()=>window.dispatchEvent(new Event('resize')));
    })();

    function RH_togglePanel(){
      var panel = document.getElementById('panel');
      var btn = document.getElementById('menuBtn');
      var willOpen = panel.classList.contains('collapsed');
      panel.classList.toggle('collapsed', !willOpen);
      panel.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
      if(btn) btn.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
      try{ localStorage.setItem('panelOpen', willOpen ? '1' : '0'); }catch(e){}
      window.dispatchEvent(new Event('resize'));
    }

    (function(){
      var fileInput  = document.getElementById('fileInput');
      var analyzeBtn = document.getElementById('analyzeBtn');
      var fileNameEl = document.getElementById('fileName');
      function updateFileState(){
        var f = (fileInput && fileInput.files && fileInput.files[0]) ? fileInput.files[0] : null;
        if (!f && fileInput && fileInput.value) { try { f = fileInput.files[0]; } catch(e){} }
        if (analyzeBtn) analyzeBtn.disabled = !f;
        if (fileNameEl) fileNameEl.textContent = f ? (' — ' + (f.name||'file')) : '';
      }
      ['change','input','blur'].forEach(ev=>{
        if(fileInput) fileInput.addEventListener(ev, ()=>setTimeout(updateFileState,0), {passive:true});
      });
      updateFileState();
    })();
  </script>
</body>
</html>
